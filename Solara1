local Players = game:GetService("Players")
local Teams = game:GetService("Teams")

local function highlightPlayer(player)
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

    local highlight = Instance.new("Highlight")
    highlight.Parent = game.CoreGui
    highlight.Adornee = humanoidRootPart
    highlight.FillColor = player.TeamColor

    player.CharacterAdded:Connect(function(newCharacter)
        highlight.Adornee = newCharacter:WaitForChild("HumanoidRootPart")
    end)
end

for _, player in pairs(Players:GetPlayers()) do
    highlightPlayer(player)
end

Players.PlayerAdded:Connect(highlightPlayer)
